<p align="center">
	<img width="400" src="https://raw.githubusercontent.com/helikon-labs/subvt/main/assets/design/logo/subvt_logo_blue.png">
</p>

![](https://github.com/helikon-labs/subvt-backend/actions/workflows/rust_checks.yml/badge.svg)
![](https://github.com/helikon-labs/subvt-backend/actions/workflows/release.yml/badge.svg)

# SubVT Backend

SubVT (Substrate Validator Toolkit) backend system implementation.

SubVT is proudly supported by the [Kusama](https://kusama.network/) Treasury. Please refer to the top-level project [repository](https://github.com/helikon-labs/subvt) for more information.

## Architecture

Complete details can be found in the
[system architecture document](https://github.com/helikon-labs/subvt/blob/main/document/software/01-subvt_system_architecture.md).

<p align="center">
  <a href="https://raw.githubusercontent.com/helikon-labs/subvt/main/document/software/image/01-subvt_system_architecture_large.jpg" target="_blank">
    <img src="https://raw.githubusercontent.com/helikon-labs/subvt/main/document/software/image/01-subvt_system_architecture_x_small.jpg"/>
  </a>
  <br/>
</p>

## Crates

| Name                                                               | Info                                                                                                                                                                                                                                                                                                                   |
|:-------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [subvt-app-service](./subvt-app-service)                           | Application REST service with such endpoints as user registration, notification rule definitions, etc. OpenAPI YAML specification document [here](./subvt-app-service/open-api-spec/subvt_app_service.yml), viewable [here](https://helikon-labs.stoplight.io/docs/subvt/YXBpOjM0Mjg0NzAw-sub-vt-application-service). |
| [subvt-block-processor](./subvt-block-processor)                   | Block processor and indexer. Stores in the PostgreSQL database the events and extrinsics of interest, era validator and staker inoformation and more.                                                                                                                                                                  |
| [subvt-config](./subvt-config)                                     | Configuration component that is used by all SubVT executables for runtime configuration.                                                                                                                                                                                                                               |
| [subvt-governance](./subvt-governance)                             | Contains the functions to fetch open referenda list and referendum details from the Polkassembly public API.                                                                                                                                                                                                           |
| [subvt-logging](./subvt-logging)                                   | Log configurator that is used by all crates.                                                                                                                                                                                                                                                                           |
| [subvt-metrics](./subvt-metrics)                                   | Common crate that contains Prometheus helper functions. Used by all other crates that export Prometheus metrics data.                                                                                                                                                                                                  |
| [subvt-network-status-server](./subvt-network-status-server)       | Publishes the network status data prepared by the network status updater through WS RPC.                                                                                                                                                                                                                               |
| [subvt-network-status-updater](./subvt-network-status-updater)     | Fetches the network status data from the Substrate node after each finalized block and stores it in the Redis instance.                                                                                                                                                                                                |
| [subvt-nft](./subvt-nft)                                           | Contains the functions to fetch NFT records for a stash account using the [sub.id](https://sub.id) public API.                                                                                                                                                                                                         |
| [subvt-nofification-generator](./subvt-notification-generator)     | Processes the indexed block (PostgreSQL), validator list (Redis) and Telemetry time-series (TimescaleDB) data for possible notifications, and persists notifications according to the previously-defined notification rules.                                                                                           |
| [subvt-notification-processor](./subvt-notification-processor)     | Processes and sends the notifications persisted by the notification generator.                                                                                                                                                                                                                                         |
| [subvt-onekv-updater](./subvt-onekv-updater)                       | Fetches the complete candidate data from the 1KV backend (only Polkadot or Kusama) in regular intervals, and Stores the candidate and all related data (ranking events, score, etc.) in the PostgreSQL network database.                                                                                               |
| [subvt-persistence](./subvt-persistence)                           | Complete persistence logic for PostgreSQL and Redis (TBD). Contains the full migrations for the network and application PostgreSQL databases.                                                                                                                                                                          |
| [subvt-plotter](./subvt-plotter)                                   | Used for server-side generation of report charts. Currently used by the Telegram bot to deliver rewards and payouts reports.                                                                                                                                                                                           |
| [subvt-proc-macro](./subvt-proc-macro)                             | Procedural macros.                                                                                                                                                                                                                                                                                                     |
| [subvt-report-service](./subvt-report-service)                     | Era and validator report REST service. OpenAPI YAML specification document [here](./subvt-report-service/open-api-spec/subvt_report_service.yml), viewable [here](https://helikon-labs.stoplight.io/docs/subvt/YXBpOjM0Mjg0NzAw-sub-vt-application-service).                                                           |                                                                                                                                                                                                                                                                                                                       |
| [subvt-service-common](./subvt-service-common)                     | Contains the service trait implemented by all SubVT services.                                                                                                                                                                                                                                                          |
| [subvt-substrate-client](./subvt-substrate-client)                 | Facilitates all of the communication between SubVT and Substrate node RPC interfaces.                                                                                                                                                                                                                                  |
| [subvt-telegram-bot](./subvt-telegram-bot)                         | SubVT Telegram bot, currently live for Kusama and Polkadot. View its readme for details.                                                                                                                                                                                                                               |
| [subvt-telemetry-processor](./subvt-telemetry-processor)           | Subscribes to the chain's feed on a Telemetry server, and persists the node data into the TimescaleDB instance for later analysis.                                                                                                                                                                                     |
| [subvt-types](./subvt-types)                                       | Complete SubVT types.                                                                                                                                                                                                                                                                                                  |
| [subvt-utility](./subvt-utility)                                   | Basic utility functions. Not used a lot at the moment, but more a place for later work.                                                                                                                                                                                                                                |
| [subvt-validator-details-server](./subvt-validator-details-server) | Publishes a validator's details through a WS RPC channel. Subscriber send the account id of the validator at the initial connection, receives the full validator data as the first response, then only the changes with the new finalized blocks.                                                                      |
| [subvt-validator-list-server](./subvt-validator-list-server)       | Publishes through its WS RPC interface the validator list data, which is prepared by the validator list updater.                                                                                                                                                                                                       |
| [subvt-validator-list-updater](./subvt-validator-list-updater)     | Every few blocks, fetches the complete inactive and active validator data from the Substrate node and the PostgreSQL network instance stores it in the Redis instance and notifies the subscriber services.                                                                                                            |